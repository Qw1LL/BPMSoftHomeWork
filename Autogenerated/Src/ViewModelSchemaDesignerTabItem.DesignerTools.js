define("ViewModelSchemaDesignerTabItem", ["ext-base", "BPMSoft", "css!ViewModelSchemaDesignerTabItem"],
	function(Ext, BPMSoft) {
		/**
		 * Class for draggable tab item elements.
		 * @class BPMSoft.ViewModelSchemaDesignerTabItem
		 * @extends {@link BPMSoft.DraggableContainer}
		 */
		Ext.define("BPMSoft.ViewModelSchemaDesignerTabItem", {
			extend: "BPMSoft.DraggableContainer",

			/**
			 * @inheritdoc BPMSoft.BaseObject#constructor
			 * @overridden
			 */
			constructor: function() {
				this.callParent(arguments);
				this.addEvents(
					/**
					 * @event ondragenter
					 * Fires on drag enter.
					 * @param {String} crossedBlockId Crossed block id.
					 */
					"ondragenter",

					/**
					 * @event ondragout
					 * Fires on drag out.
					 */
					"ondragout",

					/**
					 * @event ondragdrop
					 * Fires on drop.
					 * @param {String} droppableBlockId Droppable block id.
					 */
					"ondragdrop"
				);
			},

			/**
			 * @inheritDoc BPMSoft.Draggable#dragActionsCode
			 * @overridden
			 */
			dragActionsCode: 1,

			/**
			 * @inheritDoc BPMSoft.Draggable#dragCopy
			 * @overridden
			 */
			dragCopy: false,

			/**
			 * @inheritdoc BPMSoft.Draggable#showDropOverZoneHint
			 * @override
			 */
			showDropOverZoneHint: true,

			/**
			 * @inheritDoc BPMSoft.Draggable#grabbedClassName
			 * @overridden
			 */
			grabbedClassName: "tab-item-content-draggable-item-grabbed",

			/**
			 * @inheritDoc BPMSoft.Component#markerValue
			 * @overridden
			 */
			markerValue: null,

			/**
			 * @inheritDoc BPMSoft.Bindable#getBindConfig
			 * @overridden
			 */
			getBindConfig: function() {
				var parentBindConfig = this.callParent(arguments);
				var draggableBindConfig = this.mixins.draggable.getBindConfig.apply(this, arguments);
				return Ext.apply(draggableBindConfig, parentBindConfig);
			},

			/**
			 * @inheritDoc BPMSoft.Draggable#getDraggableConfig
			 * @overridden
			 */
			getDraggableConfig: function() {
				var containerContent = this.items.get(0);
				var draggableConfig = {};
				draggableConfig[BPMSoft.DragAction.MOVE] = {
					autoGenerateDraggableElement: false,
					elementId: Ext.String.format("{0}-caption-wrap", containerContent.id),
					handlers: {
						onDragOver: "onDragEnter",
						onDragOut: "onDragOut",
						onDragDrop: "onDragDrop",
						onInvalidDrop: "onInvalidDrop"
					}
				};
				return draggableConfig;
			},

			/**
			 * DragEnter event handler.
			 * @protected
			 * @virtual
			 * @param {String} event Event.
			 * @param {Object} crossedBlocks Crossed blocks.
			 */
			onDragEnter: function(event, crossedBlocks) {
				BPMSoft.each(crossedBlocks, function(crossedBlock) {
					if (!crossedBlock.droppableInstance && crossedBlock.config && crossedBlock.config.instance) {
						this.fireEvent("ondragenter", crossedBlock.config.instance.id);
						return false;
					}
				}, this);
			},

			/**
			 * DragOut event handler.
			 * @protected
			 * @virtual
			 */
			onDragOut: function() {
				this.fireEvent("ondragout");
			},

			/**
			 * DragDrop event handler.
			 * @protected
			 * @virtual
			 */
			onDragDrop: function() {
				this.reRender();
				this.fireEvent("ondragdrop", this.id);
			},

			/**
			 * InvalidDrop event handler.
			 * @protected
			 * @virtual
			 */
			onInvalidDrop: function() {
				this.reRender();
			},

			/**
			 * @inheritDoc BPMSoft.Draggable#getDraggableElementDefaultConfig
			 * @overridden
			 */
			getDraggableElementDefaultConfig: function() {
				return {
					isTarget: true,
					instance: this,
					tag: this.tag
				};
			}
		});

		return BPMSoft.ViewModelSchemaDesignerTabItem;
	});
